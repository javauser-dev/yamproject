<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" 
	layout:decorate="~{template/client/layout/layout}">
	
    <th:block layout:fragment="content">
        <h1>사업자 등록 정보 확인</h1>
        <form id="shopForm" action="#" th:action="@{/shop/save}" th:object="${shop}" method="post">
            <label for="name">매장명:</label>
            <input type="text" id="name" th:field="*{shopName}"><br>

            <label for="bname">사업자명:</label>
            <input type="text" id="bname" th:field="*{storeName}"><br>

            <label for="businessNumber">사업자번호:</label>
            <input type="text" id="businessNumber" th:field="*{shopBusinessNumber}"><br>

            <label for="subDate">개업일:</label>
            <input type="date" id="subDate" th:field="*{shopSubDate}"><br>

            <button type="button" onclick="verifyBusiness()">인증</button><br>

            <label for="phone">매장번호:</label>
            <input type="text" id="phone" th:field="*{shopPhone}"><br>

            <label for="address">매장주소:</label>
            <input type="text" id="address" th:field="*{shopAddress}"><br>

            <button type="button" onclick="addStore()">매장 추가</button>
        </form>

        <div id="result"></div>
    </th:block>
	
	<th:block layout:fragment="script">
		  <script>
		  function verifyBusiness() {
              const businessNumber = $('#businessNumber').val();
              const subDate = $('#subDate').val().replace(/-/g, ''); // 'YYYYMMDD' 포맷으로 변환
              const bname = $('#bname').val();

              const serviceKey = 'jEEUASAhUGj96H75IpTkbPCLORFLK3dhXoLFy9ApaJGIw65ZxLYGfSkcINdl3wy3gJ8XVQ64aKRHR1D6HGi6Cw==';

              const payload = {
                  businesses: [
                      {
                          b_no: businessNumber,
                          start_dt: subDate,
                          p_nm: bname
                      }
                  ]
              };

              $.ajax({
                  url: "https://api.odcloud.kr/api/nts-businessman/v1/validate?serviceKey=" + serviceKey,
                  type: 'POST',
                  contentType: 'application/json',
                  data: JSON.stringify(payload),
                  success: function(response) {
                      console.log(response);

                      if (response.valid_cnt === 1) {
                          alert("인증 성공하였습니다.");
                      } else {
                          alert("인증에 실패하였습니다.");
                      }
                  },
                  error: function(error) {
                      console.error('요청 중 오류 발생:', error);
                  }
              });
          }

		  function addStore() {
			    const name = $('#name').val();
			    const bname = $('#bname').val();
			    const businessNumber = $('#businessNumber').val();
			    const subDate = $('#subDate').val();
			    const phone = $('#phone').val();
			    const address = $('#address').val();

			    const payload = {
			        shopName: name,
			        storeName: bname,
			        shopBusinessNumber: businessNumber,
			        shopSubDate: subDate,
			        shopPhone: phone,
			        shopAddress: address
			    };

			    $.ajax({
			        url: "/shop/addStore", // 서버의 매장 추가 엔드포인트
			        type: 'POST',
			        contentType: 'application/json',
			        data: JSON.stringify(payload),
			        success: function(response) {
			            alert("매장이 성공적으로 추가되었습니다.");
			            console.log(response);
			        },
			        error: function(error) {
			            alert("매장 추가 중 오류가 발생했습니다.");
			            console.error('요청 중 오류 발생:', error);
			        }
			    });
			}
		</script>
	</th:block>
</html>
			