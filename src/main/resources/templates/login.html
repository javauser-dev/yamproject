<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" 
	layout:decorate="~{template/client/layout/layout}">
	
	<th:block layout:fragment="content">
<form id="loginForm">
    <input type="text" id="email" name="email" placeholder="이메일" required>
    <input type="password" id="password" name="password" placeholder="비밀번호" required>
    <input type="hidden" id="csrf_token" value="${_csrf.token}">
    <button type="submit">로그인</button>
</form>

	</th:block>
	
	<th:block layout:fragment="script">
	<script>
	document.addEventListener("DOMContentLoaded", function () {
	    const loginForm = document.getElementById("loginForm");

	    loginForm.addEventListener("submit", function (event) {
	        event.preventDefault(); // 기본 폼 제출 막기

	        const formData = new FormData(loginForm);

	        fetch("/doLogin", {
	            method: "POST",
	            body: new URLSearchParams(formData), // form-data로 변환
	            headers: {
	                "Content-Type": "application/x-www-form-urlencoded"
	            }
	        })
	        .then(response => {
	            if (!response.ok) throw new Error("로그인 실패");
	            return response.text(); // JSON이 아니라 text로 받음 (리다이렉트 대응)
	        })
	        .then(() => {
	            window.location.href = "/"; // 로그인 성공 시 메인 페이지 이동
	        })
	        .catch(error => {
	            alert("아이디 또는 비밀번호가 잘못되었습니다.");
	        });
	    });
	});
    </script>
	</th:block>
	
</html>